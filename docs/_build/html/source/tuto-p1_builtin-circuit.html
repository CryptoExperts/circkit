<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to build an arithmetic circuit &mdash; circkit  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to build a bitwise circuit" href="tuto-p1_bitwise-circuit.html" />
    <link rel="prev" title="circkit" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> circkit
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to build an arithmetic circuit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#how-to-build-a-circuit">1. How to build a circuit</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-initialize-a-new-arithmetic-circuit">Step 1: Initialize a new arithmetic circuit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#arithmetic-circuit-types">Arithmetic circuit types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#base-ring">Base ring</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-define-the-input-nodes">Step 2: Define the input nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-perform-the-computation">Step 3: Perform the computation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-operations">Basic operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-operations">Other operations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-4-define-the-output-nodes">Step 4: Define the output nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-5-evaluate-the-circuit">Step 5: Evaluate the circuit</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-visualize-a-circuit">2. How to visualize a circuit</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-transform-a-circuit-to-a-matrix">3. How to transform a circuit to a matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-trace-the-intermediate-values">4. How to trace the intermediate values</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tuto-p1_bitwise-circuit.html">How to build a bitwise circuit</a></li>
<li class="toctree-l1"><a class="reference internal" href="tuto-p1_boolean-circuit.html">How to build a boolean circuit</a></li>
<li class="toctree-l1"><a class="reference internal" href="tuto-p2_new-circuit-type.html">How to define a new circuit type</a></li>
<li class="toctree-l1"><a class="reference internal" href="tuto-p3_ISWtransformer.html">How to define a transformer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tuto-p4_bitsliceAES.html">Bit-slicing AES</a></li>
<li class="toctree-l1"><a class="reference internal" href="tuto-p4_simon.html">Simon Cipher</a></li>
<li class="toctree-l1"><a class="reference internal" href="tuto-p4_speck.html">Speck Cipher</a></li>
<li class="toctree-l1"><a class="reference internal" href="tuto-p4_BUquadratic-masking.html">Minimalist quadratic masking transformer</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">circkit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>How to build an arithmetic circuit</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/source/tuto-p1_builtin-circuit.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-to-build-an-arithmetic-circuit">
<h1>How to build an arithmetic circuit<a class="headerlink" href="#how-to-build-an-arithmetic-circuit" title="Permalink to this heading">¶</a></h1>
<p>In this tutorial, we show you how to build an arithmetic circuit based
on the <code class="docutils literal notranslate"><span class="pre">circkit</span></code> framework. In particular, we provide the instructions
on:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#how-to-build-a-circuit">How to build a circuit</a></p></li>
<li><p><a class="reference external" href="#how-to-visualize-a-circuit">How to visualize a circuit</a></p></li>
<li><p><a class="reference external" href="#how-to-transform-a-circuit-to-a-matrix">How to transform a circuit to a
matrix</a></p></li>
<li><p><a class="reference external" href="#how-to-trace-the-intermediate-values">How to trace the intermediate
values</a></p></li>
</ol>
<section id="how-to-build-a-circuit">
<h2>1. How to build a circuit<a class="headerlink" href="#how-to-build-a-circuit" title="Permalink to this heading">¶</a></h2>
<p>There are 5 steps to build a circuit.</p>
<section id="step-1-initialize-a-new-arithmetic-circuit">
<h3>Step 1: Initialize a new arithmetic circuit<a class="headerlink" href="#step-1-initialize-a-new-arithmetic-circuit" title="Permalink to this heading">¶</a></h3>
<section id="arithmetic-circuit-types">
<h4>Arithmetic circuit types<a class="headerlink" href="#arithmetic-circuit-types" title="Permalink to this heading">¶</a></h4>
<p>There are 2 types of arithmetic circuit that you can use:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ArithmeticCircuit</span></code>: This supports regular arithmetic operations
(e.g., <span class="math notranslate nohighlight">\(+\)</span>, <span class="math notranslate nohighlight">\(-\)</span>, <span class="math notranslate nohighlight">\(*\)</span>, <span class="math notranslate nohighlight">\(/\)</span>, … See step 3 for
more details)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OptArithmeticCircuit</span></code>: This inherits the <code class="docutils literal notranslate"><span class="pre">ArithmeticCircuit</span></code>
type and additionally supports</p>
<ul>
<li><p>caching operations and nodes</p></li>
<li><p>precomputing annihilator operations, e.g. a*0 = 0</p></li>
<li><p>precomputing identity operations, e.g. a*1 = a, a+0 = 0</p></li>
<li><p>precomputing constant operations</p></li>
</ul>
</li>
</ul>
<p>Here we just provide examples on the <code class="docutils literal notranslate"><span class="pre">ArithmeticCircuit</span></code> type. For the
<code class="docutils literal notranslate"><span class="pre">OptArithmeticCircuit</span></code>, it is almost similar.</p>
</section>
<section id="base-ring">
<h4>Base ring<a class="headerlink" href="#base-ring" title="Permalink to this heading">¶</a></h4>
<p>In case the computation of the circuit takes place in a field, we can
specify the ring when instantiating a new circuit. All constants in the
circuit will then be automatically converted to values in the field. Let
us take <span class="math notranslate nohighlight">\(GF(2^8)\)</span> as an example.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">circkit.arithmetic</span> <span class="kn">import</span> <span class="n">ArithmeticCircuit</span>
<span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="n">GF</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Step 1: Initialize a new arithmetic circuit</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">ArithmeticCircuit</span><span class="p">(</span><span class="n">base_ring</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;AToyCircuit&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Circuit information:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Circuit information:
&lt;ArithmeticCircuit &#39;AToyCircuit&#39; in:0 out:0 nodes:0&gt;
</pre></div>
</div>
<p>By default, if we do not specify a base ring for the circuit, the
operations of the circuit will take place in decimal numbers.</p>
</section>
</section>
<section id="step-2-define-the-input-nodes">
<h3>Step 2: Define the input nodes<a class="headerlink" href="#step-2-define-the-input-nodes" title="Permalink to this heading">¶</a></h3>
<p>We can define the input nodes of the circuit by one of the two following
methods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">add_input</span></code>: this creates an input node. We use this method to
create the input nodes one by one. Note that the name of a node
(e.g., <code class="docutils literal notranslate"><span class="pre">inp_0</span></code>, <code class="docutils literal notranslate"><span class="pre">inp_1</span></code> in the example below) is a mandatory
argument.</p></li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">circkit.arithmetic</span> <span class="kn">import</span> <span class="n">ArithmeticCircuit</span>
<span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="n">GF</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Step 1: Initialize a new arithmetic circuit</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">ArithmeticCircuit</span><span class="p">(</span><span class="n">base_ring</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;AToyCircuit&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Define the input nodes (one by one)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s2">&quot;inp_0&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s2">&quot;inp_1&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Circuit input nodes:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Circuit input nodes:
[&lt;ArithmeticCircuit:INPUT[name=inp_0]#0 ()&gt;, &lt;ArithmeticCircuit:INPUT[name=inp_1]#1 ()&gt;]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">add_inputs</span></code>: this creates a list of input nodes. Note that the
names of the nodes are specified by a format, e.g. <code class="docutils literal notranslate"><span class="pre">inp_%d</span></code> where
<code class="docutils literal notranslate"><span class="pre">%d</span></code> is automatically replaced by a counter in <span class="math notranslate nohighlight">\([0,n)\)</span>. You
can see that the following example creates the same input nodes as
the previous one.</p></li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">circkit.arithmetic</span> <span class="kn">import</span> <span class="n">ArithmeticCircuit</span>
<span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="n">GF</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Step 1: Initialize a new arithmetic circuit</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">ArithmeticCircuit</span><span class="p">(</span><span class="n">base_ring</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;AToyCircuit&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Define the input nodes (by a list)</span>
<span class="n">inp_nodes</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">add_inputs</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;inp_</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Circuit input nodes:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Circuit input nodes:
[&lt;ArithmeticCircuit:INPUT[name=inp_0]#0 ()&gt;, &lt;ArithmeticCircuit:INPUT[name=inp_1]#1 ()&gt;]
</pre></div>
</div>
</section>
<section id="step-3-perform-the-computation">
<h3>Step 3: Perform the computation<a class="headerlink" href="#step-3-perform-the-computation" title="Permalink to this heading">¶</a></h3>
<section id="basic-operations">
<h4>Basic operations<a class="headerlink" href="#basic-operations" title="Permalink to this heading">¶</a></h4>
<p>Below are the built-in operations in <code class="docutils literal notranslate"><span class="pre">ArithmeticCircuit</span></code> and
<code class="docutils literal notranslate"><span class="pre">OptArithmeticCircuit</span></code>. The operators of a operation can be nodes or
constants.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 21%" />
<col style="width: 55%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Operation</p></th>
<th class="head"><p>Notation</p></th>
<th class="head"><p>Note</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Addition</p></td>
<td><p><span class="math notranslate nohighlight">\(+\)</span></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Subtraction</p></td>
<td><p><span class="math notranslate nohighlight">\(-\)</span></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Multiplication</p></td>
<td><p><span class="math notranslate nohighlight">\(*\)</span></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Division</p></td>
<td><p><span class="math notranslate nohighlight">\(/\)</span></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Exponentiation</p></td>
<td><p><span class="math notranslate nohighlight">\(**\)</span></p></td>
<td><p>only support constant exponent</p></td>
</tr>
<tr class="row-odd"><td><p>Inversion</p></td>
<td><p><span class="math notranslate nohighlight">\(\sim\)</span></p></td>
<td><p>only for base ring elements</p></td>
</tr>
<tr class="row-even"><td><p>Negation</p></td>
<td><p><span class="math notranslate nohighlight">\(-\)</span></p></td>
<td><p>unary operation for decimal only</p></td>
</tr>
</tbody>
</table>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">circkit.arithmetic</span> <span class="kn">import</span> <span class="n">ArithmeticCircuit</span>
<span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="n">GF</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Step 1: Initialize a new arithmetic circuit</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">ArithmeticCircuit</span><span class="p">(</span><span class="n">base_ring</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;AToyCircuit&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Define the input nodes (by a list)</span>
<span class="n">inp_nodes</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">add_inputs</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;inp_</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">inp_nodes</span>

<span class="c1"># Step 3: Perform the computations</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="mi">5</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x0</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">/</span> <span class="mi">3</span>
<span class="n">x4</span> <span class="o">=</span> <span class="n">x3</span> <span class="o">**</span> <span class="mi">4</span>
<span class="n">x5</span> <span class="o">=</span> <span class="o">~</span><span class="n">x4</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Circuit information:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Circuit information:
&lt;ArithmeticCircuit &#39;AToyCircuit&#39; in:2 out:0 nodes:10&gt;
</pre></div>
</div>
</section>
<section id="other-operations">
<h4>Other operations<a class="headerlink" href="#other-operations" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>Random (<code class="docutils literal notranslate"><span class="pre">RND</span></code>): In a circuit, we can create a random node which
contains a random value. See the following example:</p></li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">circkit.arithmetic</span> <span class="kn">import</span> <span class="n">ArithmeticCircuit</span>
<span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="n">GF</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Step 1: Initialize a new arithmetic circuit</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">ArithmeticCircuit</span><span class="p">(</span><span class="n">base_ring</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;AToyCircuit&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Define the input nodes (by a list)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>

<span class="c1"># Step 3: Perform the computations</span>
<span class="c1"># x is a node holding a random value</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">RND</span><span class="p">()()</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">x</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Lookup table (<code class="docutils literal notranslate"><span class="pre">LUT</span></code>): Given a node <span class="math notranslate nohighlight">\(x\)</span> and a table <span class="math notranslate nohighlight">\(T\)</span>
of constants, this operation return a new node of value <span class="math notranslate nohighlight">\(T[x]\)</span>.</p></li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">circkit.arithmetic</span> <span class="kn">import</span> <span class="n">ArithmeticCircuit</span>
<span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="n">GF</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Step 1: Initialize a new arithmetic circuit</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">ArithmeticCircuit</span><span class="p">(</span><span class="n">base_ring</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;AToyCircuit&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Define the input nodes (by a list)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>

<span class="c1"># Step 3: Perform the computations</span>
<span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">55</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">K</span><span class="o">.</span><span class="n">fetch_int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">T</span><span class="p">])</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">LUT</span><span class="p">(</span><span class="n">T</span><span class="p">)(</span><span class="n">a</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">LUT</span><span class="p">(</span><span class="n">T</span><span class="p">)(</span><span class="n">b</span><span class="p">)</span>
<span class="c1"># Or we can write</span>
<span class="c1"># x = a.lookup_in(T)</span>
<span class="c1"># y = b.lookup_in(T)</span>
</pre></div>
</div>
</section>
</section>
<section id="step-4-define-the-output-nodes">
<h3>Step 4: Define the output nodes<a class="headerlink" href="#step-4-define-the-output-nodes" title="Permalink to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">add_output</span></code> is the only method used to define output nodes. However,
it can be used in two different ways:</p>
<ul class="simple">
<li><p>define the output nodes one by one as the following example</p></li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">circkit.arithmetic</span> <span class="kn">import</span> <span class="n">ArithmeticCircuit</span>
<span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="n">GF</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Step 1: Initialize a new arithmetic circuit</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">ArithmeticCircuit</span><span class="p">(</span><span class="n">base_ring</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;AToyCircuit&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Define the input nodes (by a list)</span>
<span class="n">inp_nodes</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">add_inputs</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;inp_</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">inp_nodes</span>

<span class="c1"># Step 3: Perform the computations</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="mi">5</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x0</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">/</span> <span class="mi">3</span>
<span class="n">x4</span> <span class="o">=</span> <span class="n">x3</span> <span class="o">**</span> <span class="mi">4</span>
<span class="n">x5</span> <span class="o">=</span> <span class="o">~</span><span class="n">x4</span>

<span class="c1"># Step 4: Define the output nodes (one by one)</span>
<span class="n">C</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="n">x4</span><span class="p">)</span>
<span class="n">C</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="n">x5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Circuit output nodes:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Circuit output nodes:
[&lt;ArithmeticCircuit:EXP[power=4]#8 (7)&gt;, &lt;ArithmeticCircuit:INV#9 (8)&gt;]
</pre></div>
</div>
<ul class="simple">
<li><p>define a list of output nodes as the following example.</p></li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">circkit.arithmetic</span> <span class="kn">import</span> <span class="n">ArithmeticCircuit</span>
<span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="n">GF</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Step 1: Initialize a new arithmetic circuit</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">ArithmeticCircuit</span><span class="p">(</span><span class="n">base_ring</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;AToyCircuit&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Define the input nodes (by a list)</span>
<span class="n">inp_nodes</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">add_inputs</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;inp_</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">inp_nodes</span>

<span class="c1"># Step 3: Perform the computations</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="mi">5</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x0</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">/</span> <span class="mi">3</span>
<span class="n">x4</span> <span class="o">=</span> <span class="n">x3</span> <span class="o">**</span> <span class="mi">4</span>
<span class="n">x5</span> <span class="o">=</span> <span class="o">~</span><span class="n">x4</span>

<span class="c1"># Step 4: Define the output nodes (one by one)</span>
<span class="n">C</span><span class="o">.</span><span class="n">add_output</span><span class="p">([</span><span class="n">x4</span><span class="p">,</span> <span class="n">x5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Circuit output:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Circuit output:
[&lt;ArithmeticCircuit:EXP[power=4]#8 (7)&gt;, &lt;ArithmeticCircuit:INV#9 (8)&gt;]
</pre></div>
</div>
</section>
<section id="step-5-evaluate-the-circuit">
<h3>Step 5: Evaluate the circuit<a class="headerlink" href="#step-5-evaluate-the-circuit" title="Permalink to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">evaluate(input:</span> <span class="pre">list,</span> <span class="pre">convert_input:</span> <span class="pre">bool,</span> <span class="pre">convert_output:</span> <span class="pre">bool)</span></code> is
the method used to evaluate a circuit. It returns a list of output
values corresponding to the output nodes. This method has 3 arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">input</span></code>: this is a list of input whose length equals to the number
of input nodes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">convert_input</span></code>: this indicates that the input elements should be
converted from decimal numbers to base ring elements or not</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">convert_output</span></code>: this indicates that the output elements should be
converted from base ring elements to decimal numbers or not.</p></li>
</ul>
<p>By default, <code class="docutils literal notranslate"><span class="pre">convert_input</span> <span class="pre">=</span> <span class="pre">True</span></code> and <code class="docutils literal notranslate"><span class="pre">convert_output</span> <span class="pre">=</span> <span class="pre">True</span></code></p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">circkit.arithmetic</span> <span class="kn">import</span> <span class="n">ArithmeticCircuit</span>
<span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="n">GF</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Step 1: Initialize a new arithmetic circuit</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">ArithmeticCircuit</span><span class="p">(</span><span class="n">base_ring</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;AToyCircuit&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Define the input nodes (by a list)</span>
<span class="n">inp_nodes</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">add_inputs</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;inp_</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">inp_nodes</span>

<span class="c1"># Step 3: Perform the computations</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="mi">5</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x0</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">/</span> <span class="mi">3</span>
<span class="n">x4</span> <span class="o">=</span> <span class="n">x3</span> <span class="o">**</span> <span class="mi">4</span>
<span class="n">x5</span> <span class="o">=</span> <span class="o">~</span><span class="n">x4</span>

<span class="c1"># Step 4: Define the output nodes (one by one)</span>
<span class="n">C</span><span class="o">.</span><span class="n">add_output</span><span class="p">([</span><span class="n">x4</span><span class="p">,</span> <span class="n">x5</span><span class="p">])</span>

<span class="c1"># Step 5: Evaluate the circuit</span>
<span class="n">inp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">convert_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convert_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Circuit output:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Circuit output:
[z8^7 + z8^6 + z8^2 + z8 + 1, z8^7 + z8^4 + z8^3 + z8^2 + z8]
</pre></div>
</div>
</section>
</section>
<section id="how-to-visualize-a-circuit">
<h2>2. How to visualize a circuit<a class="headerlink" href="#how-to-visualize-a-circuit" title="Permalink to this heading">¶</a></h2>
<p>We use <a class="reference external" href="https://graphviz.readthedocs.io/en/stable/">graphviz</a> to
visualize a circuit. Once we have a circuit, we can visualize it by
calling the method <code class="docutils literal notranslate"><span class="pre">C.digraph().view()</span></code></p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">circkit.arithmetic</span> <span class="kn">import</span> <span class="n">ArithmeticCircuit</span>
<span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="n">GF</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Step 1: Initialize a new arithmetic circuit</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">ArithmeticCircuit</span><span class="p">(</span><span class="n">base_ring</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;AToyCircuit&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Define the input nodes (by a list)</span>
<span class="n">inp_nodes</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">add_inputs</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;inp_</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">inp_nodes</span>

<span class="c1"># Step 3: Perform the computations</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">a</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x0</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">/</span> <span class="mi">3</span>
<span class="n">x4</span> <span class="o">=</span> <span class="n">x3</span> <span class="o">**</span> <span class="mi">4</span>
<span class="n">x5</span> <span class="o">=</span> <span class="o">~</span><span class="n">x4</span>

<span class="c1"># Step 4: Define the output nodes (one by one)</span>
<span class="n">C</span><span class="o">.</span><span class="n">add_output</span><span class="p">([</span><span class="n">x4</span><span class="p">,</span> <span class="n">x5</span><span class="p">])</span>

<span class="c1"># Visualize the circuit (Run the code to see)</span>
<span class="n">C</span><span class="o">.</span><span class="n">digraph</span><span class="p">()</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/circuit-visualization.png"><img alt="../_images/circuit-visualization.png" class="align-center" src="../_images/circuit-visualization.png" style="width: 400px;" /></a>
</section>
<section id="how-to-transform-a-circuit-to-a-matrix">
<h2>3. How to transform a circuit to a matrix<a class="headerlink" href="#how-to-transform-a-circuit-to-a-matrix" title="Permalink to this heading">¶</a></h2>
<p>An arithmetic circuit can be transformed to an affine
<span class="math notranslate nohighlight">\(y = Ax + b\)</span>, where <span class="math notranslate nohighlight">\(x\)</span> is the input and <span class="math notranslate nohighlight">\(y\)</span> is the
output of the circuit. It is a linear mapping when <span class="math notranslate nohighlight">\(b = 0\)</span>.</p>
<p>To be able to transform to an affine mapping, the operations of the
circuit must be in the following set:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 18%" />
<col style="width: 14%" />
<col style="width: 41%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Operation</p></th>
<th class="head"><p>Notation</p></th>
<th class="head"><p>2 nodes</p></th>
<th class="head"><p>a node and a constant</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Addition</p></td>
<td><p><span class="math notranslate nohighlight">\(+\)</span></p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>Subtraction</p></td>
<td><p><span class="math notranslate nohighlight">\(-\)</span></p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>Multiplication</p></td>
<td><p><span class="math notranslate nohighlight">\(*\)</span></p></td>
<td><p>No</p></td>
<td><p>Yes</p></td>
</tr>
</tbody>
</table>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">circkit.arithmetic</span> <span class="kn">import</span> <span class="n">ArithmeticCircuit</span>
<span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="n">GF</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">vector</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Step 1: Initialize a new arithmetic circuit</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">ArithmeticCircuit</span><span class="p">(</span><span class="n">base_ring</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;AToyCircuit&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Define the input nodes (by a list)</span>
<span class="n">inp_nodes</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">add_inputs</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;inp_</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">inp_nodes</span>

<span class="c1"># Step 3: Perform the computation</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">*</span> <span class="mi">19</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">x0</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">x4</span> <span class="o">=</span> <span class="n">x3</span> <span class="o">-</span> <span class="n">x2</span>
<span class="n">x5</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span>

<span class="c1"># Step 4: Define the output nodes (one by one)</span>
<span class="n">C</span><span class="o">.</span><span class="n">add_output</span><span class="p">([</span><span class="n">x4</span><span class="p">,</span> <span class="n">x5</span><span class="p">])</span>

<span class="c1"># Transform to a matrix</span>
<span class="n">A</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">to_matrix</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A = </span><span class="si">{</span><span class="n">A</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;b = </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>A = [[z8^5 + z8^2, z8^5 + z8^2], [z8^4 + z8 + 1, z8^4 + z8 + 1]]
b = [0, z8]
</pre></div>
</div>
<p>Let us verify that the result of the computation <span class="math notranslate nohighlight">\(y = Ax+b\)</span> is the
same as the output of the circuit’s evaluation.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verify</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">vector</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="n">inp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">convert_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convert_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">vector</span><span class="p">([</span><span class="n">K</span><span class="o">.</span><span class="n">fetch_int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inp</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Circuit output:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Verification&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;circuit output = verification? </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">out</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Circuit output:
[z8^5 + z8^3 + z8 + 1, z8^7 + z8]
Verification
(z8^5 + z8^3 + z8 + 1, z8^7 + z8)
circuit output = verification? True
</pre></div>
</div>
</section>
<section id="how-to-trace-the-intermediate-values">
<h2>4. How to trace the intermediate values<a class="headerlink" href="#how-to-trace-the-intermediate-values" title="Permalink to this heading">¶</a></h2>
<p>Given an input, we can trace the values of each node in a circuit when
evaluating the circuit. To do so, we use the function
<code class="docutils literal notranslate"><span class="pre">trace(input:</span> <span class="pre">list,</span> <span class="pre">convert_input:</span> <span class="pre">bool,</span> <span class="pre">convert_values:</span> <span class="pre">bool,</span> <span class="pre">as_list:</span> <span class="pre">bool)</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">input</span></code>: list of values fedding the input nodes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">convert_input</span></code> (<code class="docutils literal notranslate"><span class="pre">True</span></code> by default): convert the input values
from decimal to values on base ring</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">convert_values</span></code> (<code class="docutils literal notranslate"><span class="pre">True</span></code> by default): convert the intermediate
values from base ring to decimal</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as_list</span></code> (<code class="docutils literal notranslate"><span class="pre">False</span></code> by default): it returns a list of values when
<code class="docutils literal notranslate"><span class="pre">as_list=True</span></code>. Otherwise, it displays the details of nodes and
their corresponding values</p></li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">circkit.arithmetic</span> <span class="kn">import</span> <span class="n">ArithmeticCircuit</span>
<span class="kn">from</span> <span class="nn">sage.all</span> <span class="kn">import</span> <span class="n">GF</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">vector</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Step 1: Initialize a new arithmetic circuit</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">ArithmeticCircuit</span><span class="p">(</span><span class="n">base_ring</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;AToyCircuit&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Define the input nodes (by a list)</span>
<span class="n">inp_nodes</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">add_inputs</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;inp_</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">inp_nodes</span>

<span class="c1"># Step 3: Perform the computation</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">*</span> <span class="mi">19</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">x0</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">x4</span> <span class="o">=</span> <span class="n">x3</span> <span class="o">-</span> <span class="n">x2</span>
<span class="n">x5</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span>

<span class="c1"># Step 4: Define the output nodes (one by one)</span>
<span class="n">C</span><span class="o">.</span><span class="n">add_output</span><span class="p">([</span><span class="n">x4</span><span class="p">,</span> <span class="n">x5</span><span class="p">])</span>

<span class="c1"># Trace the intermediate values</span>
<span class="n">inp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">convert_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convert_values</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_list</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trace information:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

<span class="c1"># Display the graph (Run the code to see)</span>
<span class="n">C</span><span class="o">.</span><span class="n">digraph</span><span class="p">()</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Trace information:
{&lt;ArithmeticCircuit:INPUT[name=inp_0]#0 ()&gt;: 15, &lt;ArithmeticCircuit:INPUT[name=inp_1]#1 ()&gt;: 20, &lt;ArithmeticCircuit:ADD#2 (0,1)&gt;: 27, &lt;ArithmeticCircuit:CONST[value=z8^4 + z8 + 1]#3 ()&gt;: 19, &lt;ArithmeticCircuit:MUL#4 (2,3)&gt;: 128, &lt;ArithmeticCircuit:ADD#5 (4,2)&gt;: 155, &lt;ArithmeticCircuit:CONST[value=z8 + 1]#6 ()&gt;: 3, &lt;ArithmeticCircuit:MUL#7 (5,6)&gt;: 176, &lt;ArithmeticCircuit:SUB#8 (7,5)&gt;: 43, &lt;ArithmeticCircuit:CONST[value=z8]#9 ()&gt;: 2, &lt;ArithmeticCircuit:ADD#10 (4,9)&gt;: 130}
</pre></div>
</div>
<p>As we can see in the output, every node in the circuit is shown along
with its value. We can see in the graph for a better illustration. Now,
let’s set <code class="docutils literal notranslate"><span class="pre">as_list=True</span></code> to see the output:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">convert_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convert_values</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_list</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trace values:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Trace values:
[15, 20, 27, 19, 128, 155, 3, 176, 43, 2, 130]
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="circkit" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tuto-p1_bitwise-circuit.html" class="btn btn-neutral float-right" title="How to build a bitwise circuit" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, CryptoExperts.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>